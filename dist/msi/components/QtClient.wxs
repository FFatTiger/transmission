<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <?include TransmissionConfig.wxi ?>

  <Fragment>
    <ComponentGroup Id="QtClientComponents" Directory="INSTALLDIR" Source="$(var.SrcDir)\bin">
      <Component Id="exe.transmission.qt">
        <File Id="exe.transmission.qt" KeyPath="yes" Name="transmission-qt.exe">
          <Shortcut Id="exe.transmission.qt.startMenu" Directory="ProgramMenuFolder" Name="Transmission Qt Client" WorkingDirectory="INSTALLDIR" Icon="Tr.ico" Advertise="yes" />
          <Shortcut Id="exe.transmission.qt.desktop" Directory="DesktopFolder" Name="Transmission Qt Client" WorkingDirectory="INSTALLDIR" Icon="Tr.ico" Advertise="yes" />

          <TypeLib Id="{1E405FC2-1A3A-468B-8BD6-BFBB58770390}" Description="Transmission Qt Client Type Library" HelpDirectory="INSTALLDIR" Language="0" MajorVersion="1" MinorVersion="0">
            <AppId Id="{792D1AAC-53CC-4DC9-BC29-E5295FDB93A9}" Description="Transmission Qt Client">
              <Class Id="{0E2C952C-0597-491F-BA26-249D7E6FAB49}" Description="Transmission Qt Client Class" Version="1.0" Advertise="no">
                <Interface Id="{9402F54F-4906-4F20-AD73-AFCFEB5B228D}" Name="IQtClient" ProxyStubClassId32="{00020420-0000-0000-C000-000000000046}" />
                <ProgId Id="Transmission.QtClient.1" Description="Transmission Qt Client Class">
                  <ProgId Id="Transmission.QtClient" Description="Transmission Qt Client Class" />
                </ProgId>
              </Class>
            </AppId>
          </TypeLib>
        </File>

        <RegistryKey Root="HKLM" Key="SOFTWARE">
          <RegistryKey Key="Transmission\Capabilities">
            <RegistryValue Name="ApplicationDescription" Value="A fast and easy BitTorrent client." Type="string" />
            <RegistryValue Name="ApplicationIcon" Value="&quot;[#exe.transmission.qt]&quot;,0" Type="string" />
            <RegistryValue Name="ApplicationName" Value="Transmission" Type="string" />
            <RegistryValue Key="DefaultIcon" Value="&quot;[#exe.transmission.qt]&quot;,0" Type="string" />
            <RegistryValue Key="FileAssociations" Name=".torrent" Value="Transmission.TorrentFile.1" Type="string" />
            <RegistryValue Key="MIMEAssociations" Name="application/x-bittorrent" Value="Transmission.TorrentFile.1" Type="string" />
            <RegistryValue Key="URLAssociations" Name="magnet" Value="Transmission.MagnetUri.1" Type="string" />
          </RegistryKey>
          <RegistryValue Key="RegisteredApplications" Name="Transmission.$(var.TrVersionMsi)" Value="SOFTWARE\Transmission\Capabilities" Type="string" />
        </RegistryKey>

        <RegistryKey Root="HKCR" Key="Applications\transmission-qt.exe">
          <RegistryValue Key="SupportedTypes" Name=".torrent" Value="" Type="string" />
          <RegistryValue Key="shell\open\command" Value="&quot;[#exe.transmission.qt]&quot; &quot;%1&quot;" Type="string" />
        </RegistryKey>

        <RegistryKey Root="HKCR" Key=".torrent">
          <RegistryValue Name="ContentType" Value="application/x-bittorrent" Type="string" />
          <RegistryValue Key="OpenWithList\transmission-qt.exe" Value="" Type="string" />
        </RegistryKey>
        <RegistryKey Root="HKCR" Key="MIME\Database\Content Type\application/x-bittorrent">
          <RegistryValue Name="Extension" Value=".torrent" Type="string" />
        </RegistryKey>
        <RegistryKey Root="HKCR" Key="Transmission.TorrentFile.1">
          <RegistryValue Value="Torrent Metadata File" Type="string" />
          <RegistryValue Name="FriendlyTypeName" Value="@&quot;[#exe.transmission.qt]&quot;,-100" Type="string" />
          <RegistryValue Key="DefaultIcon" Value="&quot;[#exe.transmission.qt]&quot;,0" Type="string" />
          <RegistryValue Key="shell\open\command" Value="&quot;[#exe.transmission.qt]&quot; &quot;%1&quot;" Type="string" />
        </RegistryKey>

        <RegistryKey Root="HKCR" Key="magnet">
          <RegistryValue Value="URL:magnet" Type="string" />
          <RegistryValue Name="URL Protocol" Value="" Type="string" />
          <RegistryValue Key="OpenWithList\transmission-qt.exe" Value="" Type="string" />
        </RegistryKey>
        <RegistryKey Root="HKCR" Key="Transmission.MagnetUri.1">
          <RegistryValue Value="Magnet URI" Type="string" />
          <RegistryValue Name="FriendlyTypeName" Value="@&quot;[#exe.transmission.qt]&quot;,-101" Type="string" />
          <RegistryValue Name="URL Protocol" Value="" Type="string" />
          <RegistryValue Key="DefaultIcon" Value="&quot;[#exe.transmission.qt]&quot;,0" Type="string" />
          <RegistryValue Key="shell\open\command" Value="&quot;[#exe.transmission.qt]&quot; &quot;%1&quot;" Type="string" />
        </RegistryKey>

        <RegistryKey Root="HKCR" Key="AppID\transmission-qt.exe">
          <RegistryValue Name="AppID" Value="{792D1AAC-53CC-4DC9-BC29-E5295FDB93A9}" Type="string" />
        </RegistryKey>
      </Component>

      <File Id="conf.qt" Source="$(var.SrcDir)\etc\qt.conf" />

      <File Id="dll.qt.core" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)Core.dll" />
      <File Id="dll.qt.dbus" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)DBus.dll" />
      <File Id="dll.qt.gui" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)Gui.dll" />
      <File Id="dll.qt.network" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)Network.dll" />
      <File Id="dll.qt.svg" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)Svg.dll" />
      <File Id="dll.qt.widgets" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)Widgets.dll" />
      <?if $(var.QtMajorVer) = 5 ?>
      <File Id="dll.qt.winextras" Source="$(var.QtDir)\bin\Qt$(var.QtMajorVer)WinExtras.dll" />
      <?endif ?>

      <File Id="dll.qt.plugins.imageformats.gif" Subdirectory="plugins\imageformats" Source="$(var.QtDir)\plugins\imageformats\qgif.dll" />
      <File Id="dll.qt.plugins.imageformats.ico" Subdirectory="plugins\imageformats" Source="$(var.QtDir)\plugins\imageformats\qico.dll" />
      <File Id="dll.qt.plugins.imageformats.jpeg" Subdirectory="plugins\imageformats" Source="$(var.QtDir)\plugins\imageformats\qjpeg.dll" />
      <File Id="dll.qt.plugins.imageformats.svg" Subdirectory="plugins\imageformats" Source="$(var.QtDir)\plugins\imageformats\qsvg.dll" />

      <File Id="dll.qt.plugins.platforms.windows" Subdirectory="plugins\platforms" Source="$(var.QtDir)\plugins\platforms\qwindows.dll" />

      <File Id="dll.qt.plugins.styles.windowsvista" Subdirectory="plugins\styles" Source="$(var.QtDir)\plugins\styles\qwindowsvistastyle.dll" />

      <?if $(var.QtMajorVer) = 6 ?>
      <File Id="dll.qt.plugins.tls.openssl" Subdirectory="plugins\tls" Source="$(var.QtDir)\plugins\tls\qopensslbackend.dll" />
      <?endif ?>

      <File Id="dll.dbus" Source="$(var.ThirdPartyDir)\bin\dbus-1.dll" />

      <Files Subdirectory="translations" Include="$(var.TrQmSrcDir)\*.qm" />
      <Files Subdirectory="translations" Include="$(var.QtQmSrcDir)\qtbase_*.qm" />
      <Files Subdirectory="translations" Include="$(var.QtQmSrcDir)\qt_*.qm">
        <Exclude Files="$(var.QtQmSrcDir)\qt_help_*.qm" />
      </Files>
    </ComponentGroup>
  </Fragment>

</Wix>
